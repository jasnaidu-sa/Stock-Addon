<!DOCTYPE html>
<html>
<head>
    <title>Supabase Key Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 120px; margin: 10px 0; font-family: monospace; }
        .result { margin-top: 20px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Supabase Key Verification Tool</h1>
    <p>Copy your Supabase anon key from the dashboard and compare it to the key used in the application.</p>
    
    <h3>Current Key in Application</h3>
    <div>
        <p>This is the key currently used in the test files:</p>
        <textarea id="currentKey" readonly>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmanZza2FmdmNsanZ4bmF3Y2NzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MzczODQsImV4cCI6MjA1NjIxMzM4NH0.0kEvw4fWwp0Qw2fSXtmvcstZK3pYhS2yXiS0h68DEx0</textarea>
    </div>
    
    <h3>Dashboard Key</h3>
    <div>
        <p>Paste the key from your Supabase dashboard here:</p>
        <textarea id="dashboardKey" placeholder="Paste your key from the Supabase dashboard here"></textarea>
        <button onclick="compareKeys()">Compare Keys</button>
    </div>
    
    <div id="result" class="result"></div>
    
    <script>
        function compareKeys() {
            const currentKey = document.getElementById('currentKey').value.trim();
            const dashboardKey = document.getElementById('dashboardKey').value.trim();
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = '';
            
            if (!dashboardKey) {
                resultDiv.innerHTML = 'Please paste the key from your dashboard first.';
                return;
            }
            
            // Compare the keys
            if (currentKey === dashboardKey) {
                resultDiv.innerHTML = '✅ The keys match exactly!';
            } else {
                resultDiv.innerHTML = '❌ The keys do NOT match!\n\n';
                
                // Find the first character that doesn't match
                let firstDiffPos = 0;
                const minLength = Math.min(currentKey.length, dashboardKey.length);
                
                while (firstDiffPos < minLength && currentKey[firstDiffPos] === dashboardKey[firstDiffPos]) {
                    firstDiffPos++;
                }
                
                resultDiv.innerHTML += `First difference at position ${firstDiffPos}:\n`;
                
                // Show the different segments
                const start = Math.max(0, firstDiffPos - 10);
                const end = Math.min(minLength, firstDiffPos + 10);
                
                resultDiv.innerHTML += `Current key: ...${currentKey.substring(start, end)}...\n`;
                resultDiv.innerHTML += `Dashboard key: ...${dashboardKey.substring(start, end)}...\n`;
                
                // Mark the difference
                let marker = '';
                for (let i = 0; i < (firstDiffPos - start); i++) {
                    marker += ' ';
                }
                marker += '^';
                resultDiv.innerHTML += marker;
                
                // Compare lengths
                if (currentKey.length !== dashboardKey.length) {
                    resultDiv.innerHTML += `\n\nKey lengths differ: Current (${currentKey.length}) vs Dashboard (${dashboardKey.length})`;
                }
                
                // Compare JWT parts
                const currentParts = currentKey.split('.');
                const dashboardParts = dashboardKey.split('.');
                
                if (currentParts.length === 3 && dashboardParts.length === 3) {
                    // Compare payloads
                    try {
                        const currentPayload = JSON.parse(atob(currentParts[1]));
                        const dashboardPayload = JSON.parse(atob(dashboardParts[1]));
                        
                        resultDiv.innerHTML += '\n\nPayload comparison:';
                        
                        // Compare each field
                        const allFields = new Set([
                            ...Object.keys(currentPayload),
                            ...Object.keys(dashboardPayload)
                        ]);
                        
                        allFields.forEach(field => {
                            const currentValue = currentPayload[field];
                            const dashboardValue = dashboardPayload[field];
                            
                            if (JSON.stringify(currentValue) !== JSON.stringify(dashboardValue)) {
                                resultDiv.innerHTML += `\n- "${field}" differs: ${JSON.stringify(currentValue)} vs ${JSON.stringify(dashboardValue)}`;
                            }
                        });
                    } catch (e) {
                        resultDiv.innerHTML += '\n\nError parsing JWT payloads: ' + e.message;
                    }
                }
            }
        }
    </script>
</body>
</html> 