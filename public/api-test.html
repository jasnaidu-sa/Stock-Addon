<!DOCTYPE html>
<html>
<head>
    <title>Supabase API Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Supabase API Direct Test</h1>
    <p>This page tests direct API calls to Supabase endpoints</p>
    
    <button onclick="testPublicEndpoint()">Test Public Endpoint</button>
    <button onclick="testAuthEndpoint()">Test Auth Endpoint</button>
    <button onclick="testLoginEndpoint()">Test Login</button>
    
    <div id="output"></div>
    
    <script>
        const outputDiv = document.getElementById('output');
        
        // These credentials should match exactly what's in your Supabase dashboard
        const config = {
            url: 'https://cfjvskafvcljvxnawccs.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmanZza2FmdmNsanZ4bmF3Y2NzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA2MzczODQsImV4cCI6MjA1NjIxMzM4NH0.0kEvw4fWwp0Qw2fSXtmvcstZK3pYhS2yXiS0h68DEx0',
            email: 'jnaidu@thebedshop.co.za',
            password: 'admin123'
        };
        
        function writeToOutput(title, content, isError = false) {
            const titleElem = document.createElement('h3');
            titleElem.textContent = title;
            if (isError) {
                titleElem.style.color = 'red';
            }
            
            const preElem = document.createElement('pre');
            preElem.textContent = typeof content === 'object' ? JSON.stringify(content, null, 2) : content;
            
            outputDiv.appendChild(titleElem);
            outputDiv.appendChild(preElem);
        }
        
        async function testPublicEndpoint() {
            outputDiv.innerHTML = '';
            writeToOutput('Testing Public Endpoint', `URL: ${config.url}/rest/v1/`);
            
            try {
                const response = await fetch(`${config.url}/rest/v1/`, {
                    headers: {
                        'apikey': config.key,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                writeToOutput(
                    `Response (Status: ${response.status})`, 
                    data, 
                    !response.ok
                );
            } catch (error) {
                writeToOutput('Error', error.message, true);
            }
        }
        
        async function testAuthEndpoint() {
            outputDiv.innerHTML = '';
            writeToOutput('Testing Auth Endpoint', `URL: ${config.url}/auth/v1/user`);
            
            try {
                const response = await fetch(`${config.url}/auth/v1/user`, {
                    headers: {
                        'apikey': config.key,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                writeToOutput(
                    `Response (Status: ${response.status})`, 
                    data, 
                    !response.ok
                );
            } catch (error) {
                writeToOutput('Error', error.message, true);
            }
        }
        
        async function testLoginEndpoint() {
            outputDiv.innerHTML = '';
            writeToOutput('Testing Login', `URL: ${config.url}/auth/v1/token?grant_type=password`);
            writeToOutput('Request Body', {
                email: config.email,
                password: '[REDACTED]'
            });
            
            try {
                const response = await fetch(`${config.url}/auth/v1/token?grant_type=password`, {
                    method: 'POST',
                    headers: {
                        'apikey': config.key,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: config.email,
                        password: config.password
                    })
                });
                
                const data = await response.json();
                writeToOutput(
                    `Response (Status: ${response.status})`, 
                    data, 
                    !response.ok
                );
                
                if (response.ok && data.access_token) {
                    // Try to use the access token
                    writeToOutput('Access Token Received', `Token: ${data.access_token.substring(0, 10)}...`);
                    
                    const userResponse = await fetch(`${config.url}/auth/v1/user`, {
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${data.access_token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const userData = await userResponse.json();
                    writeToOutput(
                        `User Data Response (Status: ${userResponse.status})`, 
                        userData, 
                        !userResponse.ok
                    );
                }
            } catch (error) {
                writeToOutput('Error', error.message, true);
            }
        }
    </script>
</body>
</html> 